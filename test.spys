__DATA__
let println 	"println"
let fopen		"fopen"
let fclose		"fclose"
let fputstr		"fputstr"

let filename	"testing.txt"
let filemode	"wb"
let	string		"fuck this shit lol"

__CODE__
jmp 		start

fuckfiles:
	push	rbp
	mov		rbp, rsp
	sub		rsp, 4

	; [rbp - 1] arg 	filename
	; [rbp - 2] arg 	string_to_write
	; [rbp - 3] arg		loopcount
	mov		[rbp - 1], rex
	mov		[rbp - 2], rfx
	mov		[rbp - 3], rgx

	mov		rex, [rbp - 1]
	mov		rfx, filemode
	push	2
	ccall	fopen
	; [rbp - 4] local	file
	mov		[rbp - 4], rax

loop:
	gt		[rbp - 3], 0
	jif		done
	
	mov		rex, [rbp - 4]
	mov		rfx, [rbp - 2]
	push	2
	ccall	fputstr
			
	sub		[rbp - 3], 1	
	jmp		loop
done:	
	mov		rsp, rbp
	pop		rbp
	ret

start:
	
	mov		rex, filename
	mov		rfx, string
	mov		rgx, 1 
	call	fuckfiles

	exit
